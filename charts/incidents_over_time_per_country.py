import datetime
import matplotlib.pyplot as plt

def getColor(c, N, idx):
    import matplotlib as mpl
    cmap = mpl.cm.get_cmap(c)
    norm = mpl.colors.Normalize(vmin=0.0, vmax=N - 1)
    return cmap(norm(idx))

def show(data, cummelative=True):
    start = datetime.datetime(2009, 3, 22)

    country_codes = set([x[-2] for x in data])
    total = 0

    results = {x:[] for x in country_codes}
    labels = []
    tmp = {x:0 for x in country_codes}
    for i in data:
        while ((i[0]-start).days >= 1):
            labels.append(start)
            for country in country_codes:
                results[country].append(tmp[country]*100.0/total)
            start += datetime.timedelta(days=1)
            if not cummelative:
                tmp = {x:0 for x in country_codes}
                total = 0
        tmp[i[-2]] += 1
        total += 1

    rest = [vs for k,vs in results.items() if sum(vs)/len(vs) < 2]
    results = {x:results[x] for x in results if sum(results[x])/len(results[x]) >= 2}
    rest = [sum([x[i] for x in rest]) for i in range(0, len(rest[0]))]
    results['OTHER'] = rest
    idx = 0
    for country in results:
        plt.plot(labels, results[country], color=getColor('nipy_spectral', len(results), idx))
        idx += 1
    plt.ylabel('Percantage of malicious domains per country')
    plt.legend([x for x in results], ncol=4)
    plt.show()
