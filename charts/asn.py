import requests, re
import matplotlib.pyplot as plt
from bs4 import BeautifulSoup
from charts.chart import Chart

class ASNChart(Chart):

    def show(self, data, show=True):
        print('ASN')
        asns = [x[6] for x in data if x[6] != '-']
        results = {asn:asns.count(asn) for asn in asns}

        results = {k: results[k] for k in sorted(results.keys(), key=lambda x: results[x])[-15:]}
        plt.figure(figsize=(12,6))
        plt.bar(range(0,len(results)), results.values())
        plt.xlabel('ASN')
        plt.ylabel('Amount of incidents')
        plt.title('Amount of incidents per ASN')
        plt.xticks(range(0, len(results)), results.keys())
        if show:
            plt.show()
        else:
            plt.savefig('charts/results/asn.png')
        plt.close()
