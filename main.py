import datetime, requests
from charts import *


def convert_time(x):
    y = int(x.split('/')[0])
    m = int(x.split('/')[1])
    d = int(x.split('/')[2].split('_')[0])
    return datetime.datetime(y, m, d)

with open('domainlist.csv', 'rb') as f:
    data = [[y.strip('"') for y in x.split(',')] for x in f.read().decode('latin-1').split('\n')]

des_keywords = {
    'Virus': ['trojan', 'win32', 'fake', 'cryptor', 'malware', 'virus', 'banker', 'backdoor'],
    'Exploit': ['exploit', 'kit'],
    'Phishing': ['phishing']
}

for d in data:
    if (d[0] == ''):
        continue
    d[0] = convert_time(d[0])
    categories = []
    for c in des_keywords:
        for word in des_keywords[c]:
            if word in d[4].lower() and c not in categories:
                categories.append(c)
    if categories == []:
        categories = [d[4]]
    d.append(categories)
    tld = d[1].split('/')[0].split('.')[-1]
    d.append(tld)

data = [x for x in data if x[0] != '']
data.sort(key=lambda x: x[0])

for chart in CHARTS:
    chart.show(data, show=False)

#incidents_over_time_per_country.show(data)
